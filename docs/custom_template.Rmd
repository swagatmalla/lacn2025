---
title: 'LACN Operations Survey Report' 
output: 
  html_document:
    css: "style.css"
    theme: flatly
    toc: true
    toc_float: true
    toc_depth: 3
params:
  plotfont: "Source Sans Pro"
  college: NULL
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)

# load packages
library(tidyverse)
library(showtext)
library(sysfonts)

# load fonts
font_add_google(params$plotfont)

showtext_auto()

# load LACN analysis environment
load("~/lacn2025/lacn.RData")
# load("../lacn.RData")
```

#### Data from 2023-2024 {#subtitle}

<hr/>

## `r params$college` {#college}

::: {#notes style="text-align: left;"}

* If `r params$college` does not appear on a plot, it either did not respond to that question or entered 0.
* A value of zero in a summary table indicates either a response of 0 or no response.

:::

<hr/>

## Introduction


### Undergraduate Enrollment

<div class="row">

  <div class="col-sm-7">

```{r enroll-plot}
enroll_data |>
  ggplot(mapping = aes(reorder(`Institution Name`,enroll), enroll))+
  
  geom_hline(yintercept = c(0,1000,2000,3000,4000), 
               colour = 'grey')+
  geom_bar(stat="identity", fill = "#7CBCE8")+
  geom_bar(data = subset(enroll_data, `Institution Name` == params$college),
           stat = 'identity', fill = "#217DBB") +
  ggrepel::geom_text_repel(
    data = subset(
      enroll_data,
      `Institution Name` == params$college
      ),
    aes(
      label=`Institution Name`
    ),
    nudge_y=500,
    nudge_x = -7,
    color = "black",
    size = 15,
    family = params$plotfont
  )+
  
    labs(
      title = NULL,
      x = NULL,
      y = "Total"
    )+
    theme(
      axis.text.x = element_blank(),
      axis.ticks = element_blank(),
      panel.background = element_blank(),
      plot.margin = unit(c(1,1,1,1), "cm"),
      text = element_text(size = 45, family = params$plotfont)
    )
```

  </div>

  <div class="col-sm-5">

```{r enroll-table}
tableViz(enroll_data, var = "enroll", college = params$college)
```

  </div>

</div>



## Reporting and Staffing

<div class="row">

### Reporting Structure

  <div class="col-sm-9">

```{r reporting-plot}

singlePlot(reporting_data, q = "Q2",
           string_rem = ":",
           size = 45,
           font = params$plotfont,
           college = params$college,
           angle = 0)+ 
    geom_text(aes(label = paste0(round((n/sum(reporting_data$n)*100), 1), "%")),             
            hjust = -0.5,
            size = 9.5, 
            font = params$plotfont)

```

  </div>


  <div class="col-sm-3">

`r nTab(question_list$Q2['Institution Name'])`

  </div>

</div>

<div class="row">

### Steps Removed from President's Office

  <div class="col-sm-9">

```{r steps-plot}

  singlePlot(steps_data, q = "Q3",
           string_rem = "[:blank:]\\(.+\\)",
           size = 45,
           font = params$plotfont,
           college = params$college,
           angle = 270)+ 
    geom_text(aes(label = paste0(round((n/sum(steps_data$n)*100), 1), "%")),             
            hjust = -0.5,
            size = 9.5, 
            font = params$plotfont)

```

  </div>

<div class="col-sm-3">

`r nTab(question_list$Q3$Q3)`

  </div>

</div>


### Performance Metrics

```{r performance-metrics}

# MAYBE ADD A TOTAL RESPONSES

data <-
  question_list$Q4 |> 
  rename(measure1 = Q4_1,
         measure2 = Q4_2,
         measure3 = Q4_3) |>
  pivot_longer(3:5, names_to = "Measure #",
               values_to = "Measure") |>
  drop_na() |> 
  mutate(Measure = str_to_lower(Measure),
         Measure = ifelse(str_detect(Measure, "destination"), "first destination outcomes", Measure),
         Measure = ifelse(str_detect(Measure, "student engagement"), "student engagement", Measure),
         Measure = ifelse(str_detect(Measure, "internship"), "internship outcomes", Measure),
         Measure = ifelse(str_detect(Measure, "alumn"), "alumni engagement", Measure),
         Measure = ifelse(str_detect(Measure, "career outcomes"), "career outcomes", Measure),
         Measure = ifelse(str_detect(Measure, "student satisfaction"), "student satisfaction", Measure),
         Measure = ifelse(str_detect(Measure, "dei|equity"), "Diversity, Equity & Inclusion", Measure),
         Measure = ifelse(str_detect(Measure, "career outcomes"), "first destination outcomes", Measure),
         Measure = ifelse(str_detect(Measure, "^outcomes$"), "first destination outcomes", Measure),
         Measure = ifelse(str_detect(Measure, "graduate"), "first destination outcomes", Measure),
         Measure = ifelse(str_detect(Measure, "student support"), "student engagement", Measure),
         Measure = ifelse(str_detect(Measure, "^engagement$"), "student engagement", Measure),
         Measure = ifelse(str_detect(Measure, "faculty collaboration"), "faculty engagement", Measure),
         Measure = ifelse(str_detect(Measure, "er partnerships"), "employer engagement", Measure),
         Measure = ifelse(str_detect(Measure, "experiential learning"), "internship outcomes", Measure)
         ) |> 
   mutate(Measure = str_to_title(Measure), 
         Measure = ifelse(Measure == "Fds" | Measure == "Fds Outcomes", "First Destination Outcomes", Measure)) |>
  count(Measure, sort = TRUE) |>
  filter(n >= 2) %>%
  mutate(frequency = paste0(round(n/35 * 100, 1), "%"))

```



```{r college-specific-metrics}
college_response <- question_list$Q4 |> 
  rename(measure1 = Q4_1,
         measure2 = Q4_2,
         measure3 = Q4_3) |>
  pivot_longer(3:5, names_to = "Measure #",
               values_to = "Measure") |>
  drop_na() |>
  mutate(Actual_Response = Measure) |>
  mutate(Measure = str_to_lower(Measure),
         Measure = ifelse(str_detect(Measure, "destination"), "first destination outcomes", Measure),
         Measure = ifelse(str_detect(Measure, "student engagement"), "student engagement", Measure),
         Measure = ifelse(str_detect(Measure, "internship"), "internship outcomes", Measure),
         Measure = ifelse(str_detect(Measure, "alumn"), "alumni engagement", Measure),
         Measure = ifelse(str_detect(Measure, "career outcomes"), "career outcomes", Measure),
         Measure = ifelse(str_detect(Measure, "student satisfaction"), "student satisfaction", Measure),
         Measure = ifelse(str_detect(Measure, "dei|equity"), "Diversity, Equity & Inclusion", Measure),
         Measure = ifelse(str_detect(Measure, "career outcomes"), "first destination outcomes", Measure),
         Measure = ifelse(str_detect(Measure, "^outcomes$"), "first destination outcomes", Measure),
         Measure = ifelse(str_detect(Measure, "graduate"), "first destination outcomes", Measure),
         Measure = ifelse(str_detect(Measure, "student support"), "student engagement", Measure),
         Measure = ifelse(str_detect(Measure, "^engagement$"), "student engagement", Measure),
         Measure = ifelse(str_detect(Measure, "faculty collaboration"), "faculty engagement", Measure),
         Measure = ifelse(str_detect(Measure, "er partnerships"), "employer engagement", Measure),
         Measure = ifelse(str_detect(Measure, "experiential learning"), "internship outcomes", Measure)
         ) |>
  mutate(Measure = str_to_title(Measure)) |>
  filter(`Institution Name` == params$college)

```


```{r performance-metrics-table}
data |>
  mutate(`Your School` = ifelse(`Measure` %in% college_response$Measure, college_response$`Actual_Response`[(match(`Measure`, college_response$Measure))], "")) |>
  
  gt::gt() |>
    
  gt::tab_header(title = "Which Performance Measures are Most Important?",
                 subtitle = "Minimum 2 responses (n = 35)") |>
  
  
  gt::cols_label(Measure = "Performance Measure",
                 n = "N", frequency = "Frequency")|>
  
  gt::tab_style(
      style = list(
        gt::cell_text(weight = "bold")
      ),
      locations = gt::cells_column_labels(
        columns = everything()
      )
    ) |>
  gt::tab_style(
      style = list(
        gt::cell_text(style = "italic")
      ),
      locations = gt::cells_title(groups = "subtitle")
    ) |>
  gt::tab_style(
      style = list(
        gt::cell_fill(color = "aliceblue")),
      locations = gt::cells_body(
        columns = dplyr::everything(),
        rows = as.numeric(row.names(data)) %% 2 == 0
      )
    ) |>
gt::cols_width(
      Measure ~ px(250)
    )
```

Most important performance measures to your institution: 1. `r college_response$Actual_Response[1]`, 2. `r college_response$Actual_Response[2]`, and 3. `r college_response$Actual_Response[3]`.


<!-- ### Advisory Boards -->

<!-- ```{r advisory-boards} -->
<!-- all_list$multi$Q4 |> -->

<!--   left_join( -->
<!--     serviceCustom( -->
<!--       q = 'Q4', -->
<!--       dim = 'dim2' -->
<!--     ) -->
<!--   ) |> -->

<!--   suppressMessages() |> -->

<!--   dplyr::filter(n>1) |> -->

<!--   arrange(-n) |> -->

<!--   mutate(freq = round(freq*100,2)) |> -->

<!--   mutate(value = stringr::str_replace(value, "^My career.+boards$","No Advisory Boards"), -->
<!--          value = stringr::str_replace(value, "^We report.+reps$","Academic Programs & Standards Committee")) |> -->

<!--   serviceTab(q = "Q4", title = "Advisory Boards", -->
<!--              subtitle = "", -->
<!--              offer = "To Whom Do You Report?") -->
<!-- ``` -->

<!-- ### Performance Metrics -->

<!-- *Relative Importance to Senior Leadership (N = 38)* -->

<!-- ```{r performance-rank, fig.width = 9} -->
<!-- rank_data |> -->

<!--   dplyr::filter(dim1 != "Other") |> -->
<!--   ggplot(aes(reorder(dim1,-ranking_avg), ranking, colour = ranking))+ -->
<!--   geom_vline(xintercept = rank_data$dim1, colour = "grey")+ -->
<!--   geom_jitter(alpha = 0.5, width = 0, size = 3)+ -->
<!--   geom_point(aes(reorder(dim1,-ranking_avg), ranking_avg),  -->
<!--              colour = "black", -->
<!--              size = 3, -->
<!--              shape = 21)+ -->
<!--   geom_point(data = subset(rank_data, `Institution Name` == params$college & dim1 != "Other"), -->
<!--              colour = "black", -->
<!--              size = 3)+ -->
<!--   coord_flip()+ -->
<!--   scale_y_reverse(breaks = seq(1,11))+ -->
<!--   scale_color_gradientn(colours = c('#F7BF66','grey','#6AD4BF'))+ -->
<!--   scale_shape_identity()+ -->

<!--   labs( -->
<!--     y = "Importance Ranking (1=highest)" -->
<!--   )+ -->

<!--   annotate("text",  -->
<!--            x = 9.5,  -->
<!--            y = 5,  -->
<!--            label = "Mean", -->
<!--            colour = "black", -->
<!--            size = 10)+ -->

<!--   annotate("text",  -->
<!--            x = 8.5,  -->
<!--            y = deframe(rank_data[rank_data$dim1 =="Diverse student engagement" & rank_data$`Institution Name` == params$college,'ranking'])+1,  -->
<!--            label = params$college, -->
<!--            colour = "black", #"#3EA1E6", -->
<!--            size = 10)+ -->

<!--   annotate("segment",  -->
<!--            x = 9, -->
<!--            xend = 9.5,  -->
<!--            y = deframe(rank_data[rank_data$dim1=="Diverse student engagement",'ranking_avg'][1,]),  -->
<!--            yend = 4.5,  -->
<!--            colour = "black")+ -->

<!--   annotate("segment",  -->
<!--            x = 9, -->
<!--            xend = 8.7,  -->
<!--            y = deframe(rank_data[rank_data$dim1 =="Diverse student engagement" & rank_data$`Institution Name` == params$college,'ranking']),  -->
<!--            yend = deframe(rank_data[rank_data$dim1 =="Diverse student engagement" & rank_data$`Institution Name` == params$college,'ranking'])+1,  -->
<!--            colour = "black")+ -->

<!--   theme( -->
<!--     panel.background = element_blank(), -->
<!--     text = element_text(family = params$plotfont, size = 40), -->
<!--     axis.ticks.y = element_blank(), -->
<!--     axis.title.y = element_blank(), -->
<!--     axis.title.x = element_text(size = 25), -->
<!--     legend.position = "none" -->
<!--   ) -->

<!-- ``` -->


### Student Staff (Total)

<div class="row">

  <div class="col-sm-7">

```{r student-staff-plot}

matrixPlot(student_staff_data, breaks = c(0,25,50,75,100),
           font = params$plotfont,
           size = 45,
           college = params$college)

```

  </div>


  <div class="col-sm-5">

```{r student-staff-table}

tableViz(data = student_staff_data,'n', college = params$college)

```

  </div>

</div>

### Student Staff (Paraprofessional)

<div class="row">

  <div class="col-sm-7">

```{r student-para-plot}

matrixPlot(student_para_data, breaks = c(0,25,50,75,100),
           font = params$plotfont,
           size = 45,
           college = params$college)

```

  </div>


  <div class="col-sm-5">

```{r student-para-table}

tableViz(data = student_para_data,'n', college = params$college)

```

  </div>

</div>

### Student to Student Staff Ratio

<div class="row">

  <div class="col-sm-7">

```{r ss-ratio-plot}
student_stustaff_ratio %>%
  filter(n != max(student_stustaff_ratio$n)) |>
matrixPlot(breaks = c(0,250,500,750),
           font = params$plotfont,
           size = 45,
           college = params$college)+ 
  labs(caption = "* The max value (3069) is not represented in the bar chart.")+ 
  theme(
    plot.caption = element_text(size = 20) 
  )

```

  </div>
  
  <div class="col-sm-5">

```{r ss-ratio-table}

tableViz(student_stustaff_ratio, var='n', college = params$college)

```

  </div>
  
</div>



### Professional (Total FTE)

<div class="row">

  <div class="col-sm-7">

```{r prof-plot}
matrixPlot(prof_staff_data, breaks = c(0,10,20,30),
           font = params$plotfont,
           size = 45,
           college = params$college)
```

  </div>
  
  <div class="col-sm-5">

```{r prof-table}
tableViz(prof_staff_data, var = 'n', college = params$college)
```
  
  </div>
  
</div>

### Student to Professional Staff (FTE) Ratio

<div class="row">

  <div class="col-sm-7">

```{r sp-ratio-plot}

matrixPlot(student_prof_ratio, breaks = c(0,100,200,300,400,500),
           font = params$plotfont,
           size = 45,
           college = params$college)

```

  </div>
  
  <div class="col-sm-5">

```{r sp-ratio-table}

tableViz(student_prof_ratio, var='n', college = params$college)

```

  </div>
  
</div>

### Professional Staff: Responsibilities

*(drop down selection applied to both "Number of FT staff primarily dedicated" and "Number of staff involved")*
<br>
<div>
  <label for="ResponsibilityDropdown"> Responsibility: </label>
  
<select  id = "ResponsibilityDropdown">
    <option value="Student Counseling/Advising" selected>Student Counseling/Advising</option>
    <option value="Health Professions Advising">Health Professions Advising</option>
    <option value="Alumni Counseling/Advising">Alumni Counseling/Advising</option>
    <option value="Fellowship Advising">Fellowship Advising</option>
    <option value="Pre-Law Advising">Pre-Law Advising</option>
    <option value="Program/Event Planning">Program/Event Planning</option>
    <option value="Marketing/Communications">Marketing/Communications</option>
    <option value="Employer Relations">Employer Relations</option>
    <option value="Internship Funding">Internship Funding</option>
    <option value="Office Management/Front Desk">Office Management/Front Desk</option>
    <option value="Supervision of Professional Staff">Supervision of Professional Staff</option>
    <option value="Budget Management">Budget Management</option>
    <option value="Technology Management">Technology Management</option>
    <option value="Assessment (Data, Outcomes, Program)">Assessment (Data, Outcomes, Program)</option>
</select>
</div>

#### Number of FT staff primarily dedicated


<script>
  const dropdown = document.getElementById('ResponsibilityDropdown');
  dropdown.addEventListener('change', function(){
     const selection = dropdown.value;
  })
</script>

<div class="row" data-key="Q7">

  <div class="col-sm-7" data-key = "Student Counseling/Advising" style="display:none;">

```{r prof-advising-plot-Student-Counseling-Advising-FT}
prof_employer_data |> 
  select(`Institution Name`, "Q7_1_2") |> 
  rename(n = "Q7_1_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```

  </div>
  
<div class="col-sm-7" data-key = "Health Professions Advising" style="display:none;">

```{r prof-advising-plot-Health-Professions-Advising-FT}
prof_employer_data |> 
  select(`Institution Name`, "Q7_2_2") |> 
  rename(n = "Q7_2_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Alumni Counseling/Advising" style="display:none;">

```{r prof-advising-plot-Alumni-Counseling-Advising-FT}
prof_employer_data |> 
  select(`Institution Name`, "Q7_3_2") |> 
  rename(n = "Q7_3_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Fellowship Advising" style="display:none;">

```{r prof-advising-plot-Fellowship-Advising-FT}
prof_employer_data |> 
  select(`Institution Name`, "Q7_4_2") |> 
  rename(n = "Q7_4_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Pre-Law Advising" style="display:none;">

```{r prof-advising-plot-Pre-Law-Advising-FT}
prof_employer_data |> 
  select(`Institution Name`, "Q7_5_2") |> 
  rename(n = "Q7_5_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Program/Event Planning" style="display:none;">

```{r prof-advising-plot-Program-Event-Planning-FT}

prof_employer_data |> 
  select(`Institution Name`, "Q7_6_2") |> 
  rename(n = "Q7_6_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Marketing/Communications" style="display:none;">

```{r prof-advising-plot-Marketing-Communications-FT}

prof_employer_data |> 
  select(`Institution Name`, "Q7_7_2") |> 
  rename(n = "Q7_7_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Employer Relations" style="display:none;">

```{r prof-advising-plot-Employer-Relations-FT}

prof_employer_data |> 
  select(`Institution Name`, "Q7_8_2") |> 
  rename(n = "Q7_8_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Internship Funding" style="display:none;">

```{r prof-advising-plot-Internship-Funding-FT}

prof_employer_data |> 
  select(`Institution Name`, "Q7_9_2") |> 
  rename(n = "Q7_9_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Office Management/Front Desk" style="display:none;">

```{r prof-advising-plot-Office-Management-Front Desk-FT}

prof_employer_data |> 
  select(`Institution Name`, "Q7_10_2") |> 
  rename(n = "Q7_10_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Supervision of Professional Staff" style="display:none;">

```{r prof-advising-plot-Supervision-of-Professional-Staff-FT}

prof_employer_data |> 
  select(`Institution Name`, "Q7_11_2") |> 
  rename(n = "Q7_11_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Budget Management" style="display:none;">

```{r prof-advising-plot-Budget-Management-FT}

prof_employer_data |> 
  select(`Institution Name`, "Q7_12_2") |> 
  rename(n = "Q7_12_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Technology Management" style="display:none;">

```{r prof-advising-plot-Technology-Management-FT}

prof_employer_data |> 
  select(`Institution Name`, "Q7_13_2") |> 
  rename(n = "Q7_13_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Assessment (Data, Outcomes, Program)" style="display:none;">

```{r prof-advising-plot-Assessment (Data, Outcomes, Program) -FT}

prof_employer_data |> 
  select(`Institution Name`, "Q7_14_2") |> 
  rename(n = "Q7_14_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>



<div class="col-sm-5">

```{r prof-Student-Counseling-Advising-FTE, results='asis'}

advising_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_1_2") |> 
  rename(n = "Q7_1_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Student Counseling/Advising",
  style = "display:none;",
  advising_table_FT
)
```

```{r prof-Health-Professions-Advising-FTE, results='asis'}

health_professions_advising_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_2_2") |> 
  rename(n = "Q7_2_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Health Professions Advising",
  style = "display:none;",
  health_professions_advising_table_FT
)
```

```{r prof-Alumni-Advising-FTE, results='asis'}

alumni_advising_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_3_2") |> 
  rename(n = "Q7_3_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Alumni Counseling/Advising",
  style = "display:none;",
  alumni_advising_table_FT
)
```

```{r prof-Fellowship-Advising-FTE, results='asis'}

fellowship_advising_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_4_2") |> 
  rename(n = "Q7_4_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Fellowship Advising",
  style = "display:none;",
  fellowship_advising_table_FT
)
```

```{r prof-Pre-Law-Advising-FTE, results='asis'}

law_advising_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_5_2") |> 
  rename(n = "Q7_5_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Pre-Law Advising",
  style = "display:none;",
  law_advising_table_FT
)
```

```{r prof-Program/Event-Planning-FTE, results='asis'}

program_planning_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_6_2") |> 
  rename(n = "Q7_6_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Program/Event Planning",
  style = "display:none;",
  program_planning_table_FT
)
```

```{r prof-Marketing/Communications-FTE, results='asis'}

marketing_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_7_2") |> 
  rename(n = "Q7_7_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Marketing/Communications",
  style = "display:none;",
  marketing_table_FT
)
```

```{r prof-Employer-Relations-FTE, results='asis'}

employer_relations_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_8_2") |> 
  rename(n = "Q7_8_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Employer Relations",
  style = "display:none;",
  employer_relations_table_FT
)
```

```{r prof-Internship-Funding-FTE, results='asis'}

internship_funding_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_9_2") |> 
  rename(n = "Q7_9_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Internship Funding",
  style = "display:none;",
  internship_funding_table_FT
)
```

```{r prof-Office-Management/Front-Desk-FTE, results='asis'}

office_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_10_2") |> 
  rename(n = "Q7_10_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Office Management/Front Desk",
  style = "display:none;",
  office_table_FT
)
```

```{r prof-Supervision-of-Professional-Staff-FTE, results='asis'}

supervision_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_11_2") |> 
  rename(n = "Q7_11_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Supervision of Professional Staff",
  style = "display:none;",
  supervision_table_FT
)
```

```{r prof-Budget-Management-FTE, results='asis'}

budget_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_12_2") |> 
  rename(n = "Q7_12_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Budget Management",
  style = "display:none;",
  budget_table_FT
)
```


```{r prof-Technology-Management-FTE, results='asis'}

tech_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_13_2") |> 
  rename(n = "Q7_13_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Technology Management",
  style = "display:none;",
  tech_table_FT
)
```

```{r prof-Assessment-(Data, Outcomes, Program)-FTE, results='asis'}

assessment_table_FT <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_14_2") |> 
  rename(n = "Q7_14_2") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Assessment (Data, Outcomes, Program)",
  style = "display:none;",
  assessment_table_FT
)
```

</div>
</div>



#### Number of staff involved

<div class="row" data-key="Q7">

 <div class="col-sm-7" data-key = "Student Counseling/Advising" style="display:none;">

```{r prof-advising-plot-Student-Counseling-Advising-Total}
prof_employer_data |> 
  select(`Institution Name`, "Q7_1_1") |> 
  rename(n = "Q7_1_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```

  </div>
  
<div class="col-sm-7" data-key = "Health Professions Advising" style="display:none;">

```{r prof-advising-plot-Health-Professions-Advising-Total}
prof_employer_data |> 
  select(`Institution Name`, "Q7_2_1") |> 
  rename(n = "Q7_2_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
  
  </div>
  
  
<div class="col-sm-7" data-key = "Alumni Counseling/Advising" style="display:none;">

```{r prof-advising-plot-Alumni-Counseling-Advising-Total}
prof_employer_data |> 
  select(`Institution Name`, "Q7_3_1") |> 
  rename(n = "Q7_3_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Fellowship Advising" style="display:none;">

```{r prof-advising-plot-Fellowship-Advising-Total}
prof_employer_data |> 
  select(`Institution Name`, "Q7_4_1") |> 
  rename(n = "Q7_4_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Pre-Law Advising" style="display:none;">

```{r prof-advising-plot-Pre-Law-Advising-Total}
prof_employer_data |> 
  select(`Institution Name`, "Q7_5_1") |> 
  rename(n = "Q7_5_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Program/Event Planning" style="display:none;">

```{r prof-advising-plot-Program-Event-Planning-Total}

prof_employer_data |> 
  select(`Institution Name`, "Q7_6_1") |> 
  rename(n = "Q7_6_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Marketing/Communications" style="display:none;">

```{r prof-advising-plot-Marketing-Communications-Total}

prof_employer_data |> 
  select(`Institution Name`, "Q7_7_1") |> 
  rename(n = "Q7_7_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Employer Relations" style="display:none;">

```{r prof-advising-plot-Employer-Relations-Total}

prof_employer_data |> 
  select(`Institution Name`, "Q7_8_1") |> 
  rename(n = "Q7_8_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Internship Funding" style="display:none;">

```{r prof-advising-plot-Internship-Funding-Total}

prof_employer_data |> 
  select(`Institution Name`, "Q7_9_1") |> 
  rename(n = "Q7_9_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Office Management/Front Desk" style="display:none;">

```{r prof-advising-plot-Office-Management-Front Desk-Total}

prof_employer_data |> 
  select(`Institution Name`, "Q7_10_1") |> 
  rename(n = "Q7_10_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Supervision of Professional Staff" style="display:none;">

```{r prof-advising-plot-Supervision-of-Professional-Staff-Total}

prof_employer_data |> 
  select(`Institution Name`, "Q7_11_1") |> 
  rename(n = "Q7_11_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Budget Management" style="display:none;">

```{r prof-advising-plot-Budget-Management-Total}

prof_employer_data |> 
  select(`Institution Name`, "Q7_12_1") |> 
  rename(n = "Q7_12_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Technology Management" style="display:none;">

```{r prof-advising-plot-Technology-Management-Total}

prof_employer_data |> 
  select(`Institution Name`, "Q7_13_1") |> 
  rename(n = "Q7_13_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>

<div class="col-sm-7" data-key = "Assessment (Data, Outcomes, Program)" style="display:none;">

```{r prof-advising-plot-Assessment (Data, Outcomes, Program) -Total}

prof_employer_data |> 
  select(`Institution Name`, "Q7_14_1") |> 
  rename(n = "Q7_14_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
matrixPlot( breaks = c(0,5,10,15), 
           font = params$plotfont,
           size = 45, college = params$college)
```
</div>
  
  <div class="col-sm-5">
  
```{r prof-Student-Counseling-Advising-Total, results='asis'}

advising_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_1_1") |> 
  rename(n = "Q7_1_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Student Counseling/Advising",
  style = "display:none;",
  advising_table_Total
)
```

```{r prof-Health-Professions-Advising-Total, results='asis'}

health_professions_advising_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_2_1") |> 
  rename(n = "Q7_2_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Health Professions Advising",
  style = "display:none;",
  health_professions_advising_table_Total
)
```

```{r prof-Alumni-Advising-Total, results='asis'}

alumni_advising_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_3_1") |> 
  rename(n = "Q7_3_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Alumni Counseling/Advising",
  style = "display:none;",
  alumni_advising_table_Total
)
```

```{r prof-Fellowship-Advising-Total, results='asis'}

fellowship_advising_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_4_1") |> 
  rename(n = "Q7_4_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Fellowship Advising",
  style = "display:none;",
  fellowship_advising_table_Total
)
```

```{r prof-Pre-Law-Advising-Total, results='asis'}

law_advising_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_5_1") |> 
  rename(n = "Q7_5_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Pre-Law Advising",
  style = "display:none;",
  law_advising_table_Total
)
```

```{r prof-Program/Event-Planning-Total, results='asis'}

program_planning_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_6_1") |> 
  rename(n = "Q7_6_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Program/Event Planning",
  style = "display:none;",
  program_planning_table_Total
)
```

```{r prof-Marketing/Communications-Total, results='asis'}

marketing_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_7_1") |> 
  rename(n = "Q7_7_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Marketing/Communications",
  style = "display:none;",
  marketing_table_Total
)
```

```{r prof-Employer-Relations-Total, results='asis'}

employer_relations_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_8_1") |> 
  rename(n = "Q7_8_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Employer Relations",
  style = "display:none;",
  employer_relations_table_Total
)
```

```{r prof-Internship-Funding-Total, results='asis'}

internship_funding_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_9_1") |> 
  rename(n = "Q7_9_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Internship Funding",
  style = "display:none;",
  internship_funding_table_Total
)
```

```{r prof-Office-Management/Front-Desk-Total, results='asis'}

office_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_10_1") |> 
  rename(n = "Q7_10_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Office Management/Front Desk",
  style = "display:none;",
  office_table_Total
)
```

```{r prof-Supervision-of-Professional-Staff-Total, results='asis'}

supervision_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_11_1") |> 
  rename(n = "Q7_11_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Supervision of Professional Staff",
  style = "display:none;",
  supervision_table_Total
  )
```

```{r prof-Budget-Management-Total, results='asis'}

budget_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_12_1") |> 
  rename(n = "Q7_12_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Budget Management",
  style = "display:none;",
  budget_table_Total
)
```


```{r prof-Technology-Management-Total, results='asis'}

tech_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_13_1") |> 
  rename(n = "Q7_13_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Technology Management",
  style = "display:none;",
  tech_table_Total
)
```

```{r prof-Assessment-(Data, Outcomes, Program)-Total, results='asis'}

assessment_table_Total <- 
  prof_employer_data |> 
  select(`Institution Name`, "Q7_14_1") |> 
  rename(n = "Q7_14_1") |>
  filter(n > 0 & !is.na(n) & !is.infinite(n)) |>
  tableViz('n', college = params$college)

htmltools::div(
  `data-key` = "Assessment (Data, Outcomes, Program)",
  style = "display:none;",
  assessment_table_Total
)
```
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
  const dropdown = document.getElementById("ResponsibilityDropdown");

  function updatePlots() {
    const selected = dropdown.value;
    const divList = document.querySelectorAll('[data-key="Q7"]');
    divList.forEach(div => {
    Array.from(div.children).forEach(childDiv => {
        childDiv.style.display = childDiv.dataset.key === selected || childDiv.className === "col-sm-5" ? "block" : "none";
        if (childDiv.className === "col-sm-5") {
            Array.from(childDiv.children).forEach(tableDiv => {
    tableDiv.style.display = tableDiv.dataset.key === selected ? "block" : "none";
            }); 
        } 
    }); 
    });
}


  dropdown.addEventListener("change", updatePlots);
  updatePlots(); // show correct set on load
});
</script>


### National/Regional Conferences and Workshops

```{r conferences}

write_in_con <- question_list$Q8$Q8_11_TEXT

all_list$multi$Q8 |>
  
  left_join(
    serviceCustom(
      q = 'Q8',
      dim = 'dim2',
      college = params$college
    )
  ) |>
  
  suppressMessages() |>
  
    add_row(value = "Career Leadership Collective ",
          n = 6,
          freq = 6/39,
          `Your School` = "") |>
  
  dplyr::filter(!is.element(value,write_in_con)) |>
  
  dplyr::mutate(freq = round(freq*100,2),
                value = str_remove(value,":")
                ) |>
  
  arrange(-n) |>
  
  serviceTab(q = "Q8", 
             title = "Conferences Attended by Staff",
             subtitle = "",
             offer = "Conferences")
```


<hr/>

## Services and Programs

### Services Offered: Undergraduate Students

```{r service-undergrad}

write_in_userve <- question_list$Q9$Q9_13_TEXT

all_list$multi$Q9 |>
  
  left_join(
    serviceCustom(
      q = 'Q9',
      dim = 'dim2',
      college = params$college
    )
  ) |>
  
  suppressMessages() |>
  
  dplyr::filter(
    !is.element(value,write_in_userve)
  ) |>
  
  dplyr::mutate(
    value = dplyr::case_when(
      value == "Other:" ~ "Other",
      value == "Student on-campus employment" ~ "Student on-campus employment (managed)",
      TRUE ~ as.character(value)
    ),
    freq = round(freq*100,2), .keep = "unused"
  ) |>
  dplyr::arrange(-n)|>
  
  serviceTab(q = "Q9", title = "Services Offered to Undergraduates",
             subtitle = "",
             offer = "Services")

```

### Programs Offered: Undergraduate Students
```{r program-undergrad}
write_in_uprogram <- question_list$Q10$Q10_29_TEXT

all_list$multi$Q10 |>
  
  left_join(
    serviceCustom(
      q = 'Q10',
      dim = 'dim2',
      college = params$college
    )
  ) |>
  
  suppressMessages() |>
  
  dplyr::filter(
    !is.element(value,write_in_uprogram)
  ) |>
  
  dplyr::mutate(
    value = dplyr::case_when(
      value == "Other:" ~ "Other",
      TRUE ~ as.character(value)
    ),
    freq = round(freq*100,2), .keep = "unused"
  ) |>
  dplyr::arrange(-n)|>
  
  serviceTab(
    q = "Q10",
    title = "Programs Offered to Undergraduates",
    subtitle = "",
    offer = "Programs"
  )
```




### Services Offered: Graduate Students

<div class="row">

  <div class="col-sm-7">
```{r service-grad-tab}

write_in_gserve <- question_list$Q12$Q12_4_TEXT

q15_n <- question_list[['Q15']] |>
  
  dplyr::filter(dplyr::if_any(.cols = !(1:2), .fns = ~ !is.na(.x))) |>
  
  nrow()

all_list$multi$Q15 |>
  
  left_join(
    serviceCustom(
      q = 'Q15',
      dim = 'dim2',
      college = params$college
    )
  ) |>
  
  suppressMessages() |>
  
  mutate(value = stringr::str_to_title(value),
         freq = n/q15_n,
         freq = round(freq*100,2),
         `Your School` = replace_na(`Your School`,"")
         ) |>
  
  dplyr::arrange(-n) |> 
  
  serviceTab(
    q = "Q15",
    title = "Services Offered to Grad Students",
    subtitle = "",
    offer = "Services"
  )
```
  </div>
  
  <div class="col-sm-5">
  
```{r service-grad-plot}
all_list$single$Q14 |>
  
  mutate(
    Q14 = replace_na(Q14, 'No Response')
  ) |>
  
  ggplot(aes(factor(Q14, levels=c('No','Yes','No Response')), 
             n, 
             fill = Q14, 
             label = n))+
  
  geom_hline(yintercept = seq(0,25,by=5), colour = "grey")+
  geom_bar(stat = "identity", width = 0.4)+
  geom_text(size = 20, colour = "white", nudge_y = -2)+
  
  scale_y_continuous(labels = seq(0,25,by=5))+
  scale_fill_manual(
    values = c('#F7BF66','#76828E','#6AD4BF')
  )+
  
  labs(
    title = "Offered Grad Services?",
    x = NULL,
    y = NULL
  )+
  
  theme(
    text = element_text(family = params$plotfont, size = 45),
    panel.background = element_blank(),
    axis.ticks = element_blank(),
    axis.text = element_text(size = 35, colour = "black"),
    legend.position = "none"
  )
```
  

  </div>
  
</div>

### Services Offered: Alumni
<div class="row">

  <div class="col-sm-7">
```{r service-alum}

q17_n <- question_list[['Q17']] |>
  
  dplyr::filter(dplyr::if_any(.cols = !(1:2), .fns = ~ !is.na(.x))) |>
  
  nrow()

q17_custom <- question_list$Q17 |>
  filter(`Institution Name` == params$college) |>
  select(Q17) |>
  rename(value = 'Q17') |>
  add_column('Your School' = "Yes")

all_list$multi$Q17 |>
  
  left_join(
    q17_custom
  ) |>
  
  suppressMessages() |>
  
  mutate(value = stringr::str_to_title(value),
         freq = n/q17_n,
         freq = round(freq*100,2),
         `Your School` = replace_na(`Your School`,"")) |>
  
  dplyr::arrange(-n) |>
  
  serviceTab(q = "Q17", title = "Services Offered to Alumni",
             subtitle = "No write-in responses",
             offer = "Services")

```
  </div>
  
  <div class="col-sm-5">
  
  All institutions offer alumni services (`r nTab(question_list$Q14$Q14)`)

  </div>
  
</div>

## Employer Relations

### Info Sessions: Number Offered

<div class="row">

  <div class="col-sm-7">

```{r info-no-plot}
  
info_no_data |>  
  ggplot(aes(reorder(`Institution Name`,amount),amount))+
  
  geom_hline(yintercept = c(0,50,100,150,200), colour= "grey")+
  geom_bar(stat = "identity", fill="#7CBCE8")+
  geom_bar(data = subset(
    info_no_data,
    `Institution Name` == params$college),
    stat = "identity",
    fill = "#217DBB")+
  ggrepel::geom_text_repel(
    data = subset(
      info_no_data,
      `Institution Name` == params$college & dim2 == "Virtual"
      ),
    aes(
      label=`Institution Name`
    ),
    nudge_y=200,
    nudge_x = -3,
    color = "black",
    size = 15,
    family = params$plotfont
  )+
  
  labs(
    y = "Total",
    x = NULL,
    fill = NULL
  )+
  
  theme(
    text = element_text(family = params$plotfont, size = 40),
    panel.background = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks = element_blank(),
    legend.position = "top"
  )
```
  </div>
  
  <div class="col-sm-5">
```{r info-no-table}
info_no_data |>
  group_by(`Institution Name`) |>
  summarise(amount = sum(amount)) |>
  tableViz(var = 'amount', 
           college = params$college)
```
  
  </div>

</div>


### Info Sessions: Number of Employers

<div class="row">

  <div class="col-sm-7">

```{r info-employ-plot}
info_employ_data |>  
  ggplot(aes(reorder(`Institution Name`,amount),amount))+
  
  geom_hline(yintercept = c(0,50,100,150,200), colour= "grey")+
  geom_bar(stat = "identity", position="stack", fill = "#7CBCE8")+
  geom_bar(data = subset(info_employ_data, `Institution Name`== params$college),
           stat = "identity",
           fill = "#217DBB")+
  ggrepel::geom_text_repel(
    data = subset(
      info_employ_data,
      `Institution Name` == params$college & dim2 == "Virtual"
      ),
    aes(
      label=`Institution Name`
    ),
    nudge_y=75,
    color = "black",
    size = 15,
    family = params$plotfont
  )+
  
  labs(
    y = "Total",
    x = NULL,
    fill = NULL
  )+
  
  theme(
    text = element_text(family = params$plotfont, size = 40),
    panel.background = element_blank(),
    axis.text.x = element_blank(),
    axis.ticks = element_blank(),
    legend.position = "top"
  )
```
  </div>
  
  <div class="col-sm-5">
```{r info-employ-table}
info_employ_data |>
  group_by(`Institution Name`) |>
  summarise(amount = sum(amount)) |>
  tableViz(var = 'amount',
           college = params$college)
```
  
  </div>

</div>

### Number of Career "Treks"

<div class="row">

  <div class="col-sm-7">

```{r careerTreks-employ-plot}
# Create ordered institution names based on total counts
institution_levels <- relations_activities %>%
  mutate(total = `On Campus` + Virtual) %>%
  arrange(total) %>%
  pull(`Institution Name`)

# Prepare the data
mutated_rel_activities <- relations_activities |>
  mutate(
    total = `On Campus` + Virtual, 
    `Institution Name` = factor(`Institution Name`, levels = institution_levels)
  ) |>
    pivot_longer(cols = c(`On Campus`, Virtual), 
               names_to = "Mode",
               values_to = "Count") 

mutated_rel_activities|>
  ggplot(aes(
    x = `Institution Name`, 
    y = Count, 
    fill = Mode
  ))+ 
  geom_bar(stat = "identity")+
  ggrepel::geom_text_repel(
    data = subset(
      mutated_rel_activities,
      `Institution Name` == params$college & Mode == "On Campus"
      ),
    aes(
      label=`Institution Name`
    ),
    nudge_y=2,
    nudge_x = -3,
    color = "black",
    size = 10,
    family = params$plotfont
  )+
  ggplot2::scale_fill_manual(
    values=c(
             `On Campus` = "#6AD4BF",
              Virtual = "#F7BF66"))+
  
  ggplot2::labs(
    y = "Total Treks",
    x = "Institution")+
  

  ggplot2::theme(
    panel.grid.major = element_line(color = "gray80"),
    text = ggplot2::element_text(size = 45, 
                                 family = params$plotfont),
    panel.background = ggplot2::element_blank(),
    axis.text.x = ggplot2::element_blank(),
    axis.ticks = ggplot2::element_blank()
    )
```
  </div>

<div class="col-sm-3">

```{r career-trek-table}

tableViz(
  data = relations_activities |>
    dplyr::group_by(`Institution Name`) |>
    dplyr::mutate(Total = `On Campus` + Virtual, .keep = "unused"),
  
  var = "Total", 
  college = params$college
)
```

  </div>
</div>

<hr/>



## Student and Alumni Engagement

### Professional Staff Appointments with Students

*Includes in-person, phone, and video chat; excludes email consultations*

a) Appointments by Institution 
b) Appointments by Class Year

<div class="row">

  <div class="col-sm-9">

```{r appt-student-dist-plot}
level_ord <- appt_student_data %>%
  group_by(`Institution Name`) %>%
  summarize(total_appt = sum(Appt)) %>%
  arrange(total_appt) %>%
  pull(`Institution Name`)

appt_student_data |>
  mutate(`Institution Name` = factor(`Institution Name`, level_ord)) %>%
  ggplot2::ggplot(ggplot2::aes(`Institution Name`, Appt))+
  ggplot2::geom_hline(yintercept = c(0,1000,2000,3000,4000), colour = "grey")+
  ggplot2::geom_bar(ggplot2::aes(fill = Year),
                    position = "stack",
                    stat = "identity") +
  ggrepel::geom_text_repel(data = subset(appt_student_data,
                                         `Institution Name` == params$college & Year == "Senior"),
                           mapping = ggplot2::aes(label = `Institution Name`),
                           nudge_y = 1500,
                           nudge_x = -20, #was -200 before
                           size = 10, #13
                           colour = "black",
                           family = params$plotfont)+
  
  ggplot2::scale_y_continuous(breaks = c(0,1000,2000,3000,4000)) +
  ggplot2::scale_fill_manual(
    values=c(`First-Year` = "#76828E",
             Sophomore = "grey",
             Junior = "#6AD4BF",
             Senior = "#F7BF66"))+
  
  ggplot2::labs(
    y = "Total",
    x = NULL)+
  
  annotate("text",
           x = 5,
           y = 3500,
           label = "a)",
           size = 10, #15
           family = params$plotfont)+
  

  ggplot2::theme(
    text = ggplot2::element_text(size = 35,#45 
                                 family = params$plotfont),
    axis.text.x = ggplot2::element_blank(),
    axis.ticks = ggplot2::element_blank(),
    panel.background = ggplot2::element_blank(),
    legend.title = ggplot2::element_blank(),
    legend.text = ggplot2::element_text(size = 30, colour = "black"),
    legend.position = "right"
    )

```

  </div>
  
  <div class="col-sm-3">

```{r appt-student-dist-table}
appt_student_data |>
    dplyr::group_by(`Institution Name`) |>
    dplyr::summarise(Appt = sum(Appt)) |>
  
  tableViz(var = "Appt", college = params$college)
```

  </div>
  
</div>

<div class="row">

```{r appt-student-group-plot, fig.width=9}

appt_student_data |>

  dplyr::group_by(Year) |>
  dplyr::summarise(Mean = mean(Appt, na.rm = TRUE), 
                   Median = median(Appt, na.rm = TRUE),
                   Max = max(Appt, na.rm = TRUE),
                   `Your School` = mean(Appt[`Institution Name`==params$college])
                   ) |>
  
  tidyr::pivot_longer(
    cols = !Year,
    names_to = "measure",
    values_to = "amount"
  ) |>
  
  mutate(measure = factor(measure, levels = c('Mean','Median','Max',"Your School"))) |>
  
  ggplot2::ggplot(ggplot2::aes(Year, amount, fill = measure))+
  ggplot2::geom_hline(yintercept = c(0,500,1000,1500,2000), colour = "grey")+
  ggplot2::geom_bar(ggplot2::aes(fill = measure),
                    position = "dodge",
                    stat = "identity") +
  geom_text(aes(label = round(amount,0)),
            colour = "white", size = 9,
            hjust = 1.2,
            position = position_dodge(.9),
            angle = 90)+
  
  ggplot2::scale_fill_manual(
    values = c(
      Mean = "#6AD4BF", 
      Median = "#F7BF66", 
      Max = "#76828E", 
      `Your School` = "#7CBCE8")
      )+
  
  ggplot2::labs(
    y = "Total",
    x = NULL)+
  
    annotate("text",
           x = 0.7,
           y = 1750,
           label = "b)",
           size = 15,
           family = params$plotfont)+
  

  ggplot2::theme(
    text = ggplot2::element_text(size = 45, 
                                 family = params$plotfont),
    axis.text.x = ggplot2::element_text(size = 30, colour = "black"),
    axis.ticks = ggplot2::element_blank(),
    panel.background = ggplot2::element_blank(),
    legend.title = ggplot2::element_blank(),
    legend.text = ggplot2::element_text(size = 30, colour = "black"),
    legend.position = "right"
  )
```

  
</div>

### Professional Staff Appointments + Email Consultations (Alumni only)

<div class="row">

  <div class="col-sm-7">

```{r appt-alum-plot}
appt_alum_data |>
  
  mutate(dim2 = factor(dim2, levels = c('Email Consultations','Appointments*'))) |>
  
  ggplot2::ggplot(ggplot2::aes(reorder(`Institution Name`, engage), engage))+
  ggplot2::geom_hline(yintercept = c(0,500,1000,1500), colour = "grey")+
  ggplot2::geom_bar(ggplot2::aes(fill = dim2),
                    position = "stack",
                    stat = "identity")+
  
  ggrepel::geom_text_repel(
    data = subset(
      appt_alum_data,
      `Institution Name` == params$college & dim2 == "Appointments*"
      ),
    aes(
      label=`Institution Name`
    ),
    nudge_y=500,
    nudge_x = -7,
    color = "black",
    size = 15,
    family = params$plotfont
  )+
  
  ggplot2::labs(
    y = "Total",
    x = NULL,
    caption = "*In-Person, Phone, or Video Chat"
  )+
  ggplot2::scale_fill_manual(
    values = c(
      `Email Consultations` = "#6AD4BF",
      `Appointments*` = "#F7BF66"
    )
  )+
  ggplot2::theme(
    text = ggplot2::element_text(size = 40, family = params$plotfont),
    axis.text.x = ggplot2::element_blank(),
    axis.ticks = ggplot2::element_blank(),
    panel.background = ggplot2::element_blank(),
    legend.title = ggplot2::element_blank(),
    legend.position = "top"
  )
```

  </div>
  
  <div class="col-sm-5">

```{r appt-alum-table}

appt_alum_data |>
  dplyr::group_by(`Institution Name`) |>
  dplyr::summarise(engage = sum(engage)) |>
tableViz(
  var = "engage", 
  na.rm = TRUE,
  college = params$college
  )
```

  </div>
  
</div>

### Professional Staff Appointments + Email Consultations per Total Professional Staff FTE

<div class="row">

  <div class="col-sm-7">

```{r appt-fte-plot}
appt_fte_data |>
  ggplot2::ggplot(ggplot2::aes(reorder(`Institution Name`,ratio),ratio))+
  ggplot2::geom_hline(yintercept = c(0,200,400,600,800), colour = "grey")+
  ggplot2::geom_bar(stat = "identity", fill = "#7CBCE8")+
  
  geom_bar(data = subset(appt_fte_data, `Institution Name` == params$college),
           stat = 'identity', fill = "#217DBB") +
  
  ggrepel::geom_text_repel(
    data = subset(
      appt_fte_data,
      `Institution Name` == params$college
      ),
    aes(
      label=`Institution Name`
    ),
    nudge_y=200,
    nudge_x = -7,
    color = "black",
    size = 15,
    family = params$plotfont
  )+
  
  ggplot2::labs(
    x = NULL,
    y = "Appt. to FTE Ratio",
    caption = "Note: includes only institutions that\n reported both appointments and FTE"
  )+
  
  ggplot2::theme(
    text = ggplot2::element_text(size = 40, family = params$plotfont,
                                 lineheight = .5),
    plot.caption = element_text(size = 20),
    panel.background = ggplot2::element_blank(),
    axis.ticks = ggplot2::element_blank(),
    axis.text.x = ggplot2::element_blank()
  )
```

  </div>
  
  <div class="col-sm-5">

```{r appt-fte-table}
tableViz(appt_fte_data, var = "ratio", na.rm = TRUE, college = params$college)
```
  </div>
  
</div>

### Student Engagement by Class Year

<div class="row">

  <div class="col-sm-9">

```{r sengage-year-plot}

sengage_year_data |>
  
  dplyr::group_by(dim1) |>
  dplyr::summarise(Mean = mean(engage, na.rm = TRUE), 
                   Median = median(engage, na.rm = TRUE),
                   Max = max(engage, na.rm = TRUE),
                   `Your School` = mean(engage[`Institution Name`==params$college])
                   ) |>
  dplyr::mutate(dim1 = stringr::str_replace(dim1, regex("TOTAL"),"Total\n")) |>
  tidyr::pivot_longer(
    cols = !dim1,
    names_to = "measure",
    values_to = "engage"
  ) |>
  
  dplyr::mutate(dim1 = factor(dim1, levels = c(
    "First-Year",
    "Sophomore",
    "Junior",
    "Senior",
    "Total\n (all classes)"))
  ) |>
  
  mutate(measure = factor(measure, levels = c("Mean","Median","Max", "Your School"))) |>
  
  ggplot2::ggplot(ggplot2::aes(dim1, engage))+
  
  ggplot2::geom_hline(yintercept = c(0,25,50,75,100), colour = "grey")+
  ggplot2::geom_bar(ggplot2::aes(fill = measure),
                    position = "dodge",
                    stat = "identity")+
  geom_text(aes(fill = measure, label = round(engage,0)),
    colour = "white", size = 9,
    vjust = 1.5, position = position_dodge(.9)
    )+
  
  ggplot2::scale_y_continuous(limits = c(0,100), breaks = c(0,25,50,75,100))+
  ggplot2::scale_fill_manual(
    values=c(Mean = "#6AD4BF", 
             Median = "#F7BF66", 
             Max = "#76828E", 
             `Your School` = "#7CBCE8"))+
  
  ggplot2::labs(
    y = "Engagement (%)",
    x = NULL
  )+
  
  ggplot2::theme(
    text = ggplot2::element_text(size = 45, family = params$plotfont),
    axis.ticks = ggplot2::element_blank(),
    axis.text.x = ggplot2::element_text(size = 30, lineheight = 0.5, colour = "black"),
    panel.background = ggplot2::element_blank(),
    legend.title = ggplot2::element_blank(),
    legend.text = element_text(size = 30),
    legend.position = "top"
    )
```

  </div>
  
  <div class="col-sm-3">
  
`r nTab(question_list$Q23$Q23_5_4)`

\n \n Note: Engagement \n includes appointments \n w/ professional staff \n and peer advisors and \n programs and events

  </div>
  
</div>

### Student Engagement by Type of Engagement

<div class="row">

  <div class="col-sm-9">

```{r sengage-type-plot}
sengage_type_data |>
  
    dplyr::mutate(dim2 = case_when(
    dim2 == "% engaged through appointment with professional staff" ~ "% engaged through appointment with professional staff*",
    TRUE ~ as.character(dim2)
  )) |>

  dplyr::select(!c(main:sub2,Question))  |>
  dplyr::mutate(across(`Undergraduate enrollment`:engage, as.numeric)) |> 
  
  dplyr::filter(dim1 == "TOTAL (all classes)") |>
  
  dplyr::group_by(dim2) |> 
  dplyr::summarise(Mean = mean(engage, na.rm = TRUE), 
                   Median = median(engage, na.rm = TRUE),
                   Max = max(engage, na.rm = TRUE),
                   `Your School` = mean(engage[`Institution Name`== params$college & dim1 == "TOTAL (all classes)"], na.rm = TRUE)
  ) |>
  tidyr::pivot_longer(
    cols = !dim2,
    names_to = "measure",
    values_to = "engage"
  ) |>
  
  mutate(measure = factor(measure, levels = c('Mean','Median','Max',"Your School"))) |>
  
  ggplot2::ggplot(ggplot2::aes(dim2,engage, fill = measure))+
  
  ggplot2::geom_hline(yintercept = c(0,25,50,75,100), colour = "grey")+
  ggplot2::geom_bar(ggplot2::aes(fill = measure),
                    position = "dodge",
                    stat = "identity")+
  geom_text(aes(label = round(engage,0)),
            colour = "white", size = 8.5,
            vjust = 1.4, position = position_dodge(.9)
            )+
  ggplot2::scale_y_continuous(limits = c(0,100), breaks = c(0,25,50,75,100))+
  scale_x_discrete(labels = function(x) stringr::str_wrap(x, width = 15))+
  ggplot2::labs(
    y = "Engagement (%)",
    x = NULL,
    caption = "*Includes in-person, phone, video chat, \nand email consultations"
  )+
  ggplot2::scale_fill_manual(
    values=c(Mean = "#6AD4BF",
             Median = "#F7BF66",
             Max = "#76828E", 
             `Your School` = "#7CBCE8"
    )
  )+
  ggplot2::theme(
    text = ggplot2::element_text(size = 45, family = params$plotfont,
                                 lineheight = .5),
    axis.ticks = ggplot2::element_blank(),
    axis.text.x = ggplot2::element_text(size = 30, colour = "black"),
    panel.background = ggplot2::element_blank(),
    legend.title = ggplot2::element_blank(),
    legend.text = element_text(size = 30),
    legend.position = "top",
    plot.caption = element_text(size = 25)
  )
```

  </div>
  
  <div class="col-sm-3">

```{r sengage-tyle-table, echo=FALSE}
sengage_tab_data <- sengage_type_data |> 
  mutate(engage = as.numeric(engage)) |> 
  group_by(`Institution Name`) |>
  summarise(engage = mean(engage, na.rm = TRUE)) |>
  dplyr::filter(is.finite(engage))
```


`r nTab(sengage_tab_data$engage)`

  </div>
  
</div>


### Experiential Learning Participation

*% of students who completed by graduation*

<div class="row">

  <div class="col-sm-9">

```{r exper-learning-plot}
exper_learning_data |>
  
  dplyr::mutate(dim1 = stringr::str_replace(dim1,
                                           "Internship \\(.+",
                                           "Internship**")) |>
  dplyr::group_by(dim1) |>
  dplyr::summarise(Mean = mean(exper, na.rm = TRUE), 
                   Median = median(exper, na.rm = TRUE),
                   Max = max(exper, na.rm = TRUE),
                   `Your School` = mean(exper[`Institution Name`==params$college], na.rm = TRUE)
  ) |>
  
  tidyr::pivot_longer(
    cols = !dim1,
    names_to = "measure",
    values_to = "exper"
  ) |>
  
  mutate(measure = factor(measure, levels = c('Mean','Median','Max','Your School'))) |>
  
  ggplot2::ggplot(ggplot2::aes(reorder(dim1,-exper),exper, fill = measure))+
  
  ggplot2::geom_hline(yintercept = c(0,25,50,75,100), colour = "grey")+
  ggplot2::geom_bar(ggplot2::aes(fill = measure),
                    stat = "identity",
                    position = "dodge")+
   geom_text(
    aes(label = round(exper,0)),
    colour = "white", size = 8,
    vjust = 1.4, position = position_dodge(.9)
    )+
  ggplot2::scale_x_discrete(
    labels = function(x) stringr::str_wrap(x, width = 12)
    )+
  ggplot2::labs(
    x = NULL,
    y = "% of Students",
    caption = "*Internship, pre-licensure field experience, mentored experience or similar professional experience\n **Including pre-licensure field experience, NOT including mentored undergraduate research"
  )+
  ggplot2::scale_fill_manual(
    values=c(Mean = "#6AD4BF",
             Median = "#F7BF66",
             Max = "#76828E",
             `Your School` = "#7CBCE8"
    )
  )+
  ggplot2::theme(
    plot.caption = ggplot2::element_text(size = 20, 
                                         margin = ggplot2::margin(t = "10")),
    text = ggplot2::element_text(size = 45, family = params$plotfont,
                                 lineheight = .5),
    axis.text.x = ggplot2::element_text(size = 25, colour = "black"),
    panel.background = ggplot2::element_blank(),
    axis.ticks = ggplot2::element_blank(),
    legend.position = "top",
    legend.text = element_text(size = 30),
    legend.title = ggplot2::element_blank()
  )

```

  </div>
  
  <div class="col-sm-3">

```{r exper-learning-table, echo=FALSE}

exper_learning_data |>
  mutate(dim1 = stringr::str_replace(dim1,
                                           "Internship \\(.+",
                                           "Internship**")) |>
  filter(!is.na(exper)) |>
  group_by(dim1)|>
  summarise(count = n()) |>
  
  mutate(dim1 = stringr::str_remove_all(dim1,"\\(.+\\)"),
         # dim1= stringr::str_remove_all(dim1, "\\*")
         dim1 = fct_relevel(dim1, "Any Experiential Learning*", "Internship**", "Paid internship", "Mentored research experience", "Internship funded by your institution", "Internship for academic credit")
         )|>
  arrange(-count) |>
  gt::gt() |>
  
    
  gt::tab_header(title = "Summary",
                 subtitle = "# of respondents by experience") |>
  
  
  gt::cols_label(dim1 = "Experience",
                 count = "N")|>
  
  gt::tab_style(
      style = list(
        gt::cell_text(weight = "bold")
      ),
      locations = gt::cells_column_labels(
        columns = everything()
      )
    ) |>
  gt::tab_style(
      style = list(
        gt::cell_text(style = "italic")
      ),
      locations = gt::cells_title(groups = "subtitle")
    ) |>
gt::cols_width(
      dim1 ~ px(150)
    )

```

  </div>
  
</div>

<hr/>

## Budget

### Total Available Funding

*Operating + Endowed Funds + Expendable Gifts + Other*

<div class="row">

  <div class="col-sm-7">
  
```{r total-funding-plot}
budget_levels <- total_budget %>%
  group_by(`Institution Name`) %>%
  summarize(total_budget = sum(amount_mil)) %>%
  arrange(total_budget)%>%
  pull(`Institution Name`)

total_budget |>
  
  mutate(Budget = factor(Budget, levels = c('Total_OP','Total_NOP'))) |>
   mutate(`Institution Name` = factor(`Institution Name`, levels = budget_levels))  %>%
  
  ggplot(aes(`Institution Name`, amount_mil, fill = Budget))+
  geom_hline(yintercept = c(0,1,2,3), colour = "grey")+
  geom_bar(stat = 'identity')+
  ggrepel::geom_text_repel(
    data = subset(
      total_budget,
      `Institution Name` == params$college & Budget == "Total_NOP"
      ),
    aes(
      label=`Institution Name`
    ),
    nudge_y=2,
    nudge_x = -3,
    color = "black",
    size = 15,
    family = params$plotfont
  )+
  labs(
    x = NULL,
    y = "Total (in millions)"
  )+
  scale_fill_manual(values=c("#F7BF66","#6AD4BF"),
                    breaks=c("Total_OP", "Total_NOP"),
                    labels=c("Operating", "Non-Operating"))+
  scale_y_continuous(breaks = c(0,1,2,3),
                     labels = c("0","1","2","$3"))+
  theme(
    text = element_text(family = params$plotfont, size = 40),
    panel.background = element_blank(),
    axis.ticks = element_blank(),
    axis.text.x = element_blank(),
    legend.text = element_text(size = 25),
    legend.title = element_blank(),
    legend.position = "top"
  )

```

  </div>
  
  <div class="col-sm-5">

```{r total-funding-table}
total_budget |>
    dplyr::group_by(`Institution Name`) |>
    dplyr::summarise(total = sum(amount)) |>
tableViz(
  var = 'total',
  subtitle = "Total (operating and non-operating)",
  college = params$college
)

```

  </div>
  
</div>

### Endowed Funds

<div class="row">

  <div class="col-sm-7">

```{r endow-fund-plot}
endow_exp_data |>
  ggplot2::ggplot(ggplot2::aes(reorder(`Institution Name`, amount_mil), amount_mil))+
  ggplot2::geom_hline(yintercept = c(0,0.5,1,1.5,2), colour = "grey")+
  ggplot2::geom_bar(stat = "identity", fill = "#7CBCE8") +
  
  geom_bar(data = subset(endow_exp_data, `Institution Name` == params$college),
           stat = 'identity', fill = "#217DBB") +
  ggrepel::geom_text_repel(
    data = subset(
      endow_exp_data,
      `Institution Name` == params$college & dim2 == "Funded Internships"),
    aes(
      label=`Institution Name`
    ),
    nudge_y=1,
    nudge_x = -9,
    color = "black",
    size = 15,
    family = params$plotfont
  )+
  
  ggplot2::labs(
    y = "Total (in millions)",
    x = NULL
  )+  # made changes to the labels because it wasn't working for some colleges
  ggplot2::scale_y_continuous(labels =  scales::dollar_format(suffix = "M"))+ 

 # ggplot2::scale_y_continuous(labels = #c("0","0.5","1","1.5","$2"))+
  
  ggplot2::theme(
    text = ggplot2::element_text(family = params$plotfont, size = 40),
    panel.background = ggplot2::element_blank(),
    axis.text.x = ggplot2::element_blank(),
    axis.ticks = ggplot2::element_blank(),
    legend.title = ggplot2::element_blank(),
    legend.text = ggplot2::element_text(size = 30)
  )
```

  </div>
  
  <div class="col-sm-5">

```{r endow-fund-table}
endow_exp_data |>
  dplyr::group_by(`Institution Name`) |>
  dplyr::summarise(amount = sum(amount)) |> 
tableViz(
  var = 'amount',
  college = params$college)
```

  </div>
  
</div>

### Expendable Gifts

<div class="row">

  <div class="col-sm-7">

```{r expend-gift-plot}
gift_data |>
  ggplot2::ggplot(ggplot2::aes(reorder(`Institution Name`, amount_mil), amount_mil))+
  ggplot2::geom_hline(yintercept = c(0,0.5,1,1.5), colour = "grey")+
  ggplot2::geom_bar(stat = "identity", fill = "#7CBCE8")+
  
  geom_bar(data = subset(gift_data, `Institution Name` == params$college),
           stat = 'identity', fill = "#217DBB") +
  ggrepel::geom_text_repel(
    data = subset(
      gift_data,
      `Institution Name` == params$college & dim2 == "Funded Internships"),
    aes(
      label=`Institution Name`
    ),
    nudge_y = 0.5,
    nudge_x = -2,
    color = "black",
    size = 15,
    family = params$plotfont
  )+
  
  ggplot2::labs(
    y = "Total (in millions)",
    x = NULL
  )+
  
  ggplot2::scale_y_continuous(breaks = c(0,0.5,1,1.5),
                              labels = c("0","0.5","1","$1.5"))+
  
  ggplot2::theme(
    text = ggplot2::element_text(family = params$plotfont, size = 40),
    panel.background = ggplot2::element_blank(),
    axis.text.x = ggplot2::element_blank(),
    axis.ticks = ggplot2::element_blank(),
    legend.title = ggplot2::element_blank(),
    legend.text = ggplot2::element_text(size = 30)
  )
```

  </div>
  
  <div class="col-sm-5">

```{r expend-gift-table}
gift_data |>
  dplyr::group_by(`Institution Name`) |>
  dplyr::summarise(amount = sum(amount)) |>
  dplyr::filter(!is.na(amount) & amount > 0) |>
  tableViz(var = "amount",
  college = params$college)
```

  </div>
  
</div>

<hr/>

**Published May 2025, Data Analysis completed by St Olaf College**


